rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Note: Since we're using Telegram WebApp without Firebase Auth,
    // request.auth will always be null. Admin verification is done client-side.
    // We allow read access for admin dashboard statistics.
    
    // Users collection - allow read for admin dashboard
    match /users/{userId} {
      // Allow read access to all user documents (needed for admin dashboard)
      // Admin verification is done client-side in AdminContext
      allow read: if true;
      
      // Allow write only to own user document (basic validation)
      allow write: if request.resource == null || 
                      (request.resource.data.keys().hasAll(['createdAt']) && 
                       (resource == null || resource.data.createdAt == request.resource.data.createdAt));
      
      match /subscriptions/{subscriptionId} {
        // Allow read access to all subscriptions (needed for admin dashboard)
        allow read: if true;
        // Allow write - client-side verification ensures users only modify their own data
        allow write: if true;
      }

      match /expenses/{expenseId} {
        // Allow read access to all expenses (needed for analytics/admin potential)
        allow read: if true;
        // Allow write - client-side verification ensures users only modify their own data
        allow write: if true;
      }
      
      match /categories/{categoryId} {
        // Allow read access to all categories (needed for admin dashboard)
        allow read: if true;
        // Allow write - client-side verification ensures users only modify their own data
        allow write: if true;
      }
    }
    
    // Config collection - public read, admin write (verified client-side)
    match /config/{document} {
      allow read: if true;
      allow write: if true; // Admin verification done client-side
    }
  }
}
